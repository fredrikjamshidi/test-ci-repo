services:
  app:
    image: $APP_IMAGAE:latest-rc
    platform: linux/x86_64
    restart: unless-stopped
    ports:
      - '$APP_PORT:3000'
    depends_on:
      - db
    environment:
      DATABASE_URL: "postgresql://$DB_USER:$DB_PASSWORD@localhost:$DB_PORT/$DB_NAME?schema=public"
      API_key: $API_TOKEN

  db:
    image: docker.io/postgres:17
    platform: linux/x86_64
    restart: unless-stopped
    ports:
      - '$DB_PORT:5432'
    environment:
      POSTGRES_USER: $DB_USER
      POSTGRES_PASSWORD: $DB_PASSWORD
      POSTGRES_DB: $DB_NAME
    volumes:
      - pgdata:/var/lib/postgresql/data

volumes:
  pgdata: